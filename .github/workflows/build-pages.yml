name: Build static content to Pages

on:
  # Runs on pushes targeting the default branch
#   push:
    # branches: [$default-branch]
    # branches: 
    # - gh-pages

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
    contents: read
    pages: write
    id-token: write
  
# Allow one concurrent deployment
concurrency:
    group: "pages"
    cancel-in-progress: true


jobs:
    build:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            ref: pages
        - run: |
            git config --global user.email "you@example.com"
            git config --global user.name "maxksorg builder"
            git fetch
            git merge origin/main --allow-unrelated-histories --strategy-option theirs
            npm install
            rm -rf /home/runner/work/maxcoga.github.io/maxcoga.github.io/public/
            npm run build
            git add *
            currentDate="`date +'%Y-%m-%d %H:%M:%S'`"
            gitmsg="Build: $currentDate"
            git commit -m "$gitmsg"
            git push -u origin pages --force